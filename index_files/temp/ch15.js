ChPages=function(){};ChPages._isEnabled=true;ChPages._isInitialized=false;ChPages._isCommentFormAjaxRequest=false;ChPages._curCommand='';ChPages._curCommandI='';ChPages._commentNum=0;ChPages._delayedArticleStat=false;ChPages._delayedLoadVoteForm=false;ChPages.Command_ArticleStat='arstat';ChPages.Command_ArticleCommentsStat='arcommstat';ChPages.Command_ShowSideVote='shvoteside';ChPages.Command_ProcessVote='prvote';ChPages.Initialize=function(){$(window).bind("resize",ChPages.OnWindowResize);$("body").click(function(event){return ChPages.OnCommonClick(event);});ChPages.InitCommentForm();ChPages._isInitialized=true;if(ChPages.CheckNeedArticleStat())ChPages._delayedArticleStat=true;ChPages._delayedLoadVoteForm=true;ChPages.RunDelayedOperations();};ChPages.OnCommonClick=function(event){var clickedLink=$(event.target).closest("a");if(clickedLink.length>0){return ChPages.ProcessCommonLinkClick(clickedLink.get(0));}return true;};ChPages.OnWindowResize=function(){ChPages.ResizeCommentFormProgressControl();};ChPages.ProcessCommonLinkClick=function(target){var href=$(target).attr("href");var hashText,hashCommand,hashCommandArg;if(href.indexOf('#')>-1){hashText=href.substr(href.indexOf('#')+1);if(hashText){if(hashText.indexOf('-')>-1){hashCommand=hashText.substr(0,hashText.indexOf('-'));hashCommandArg=hashText.substr(hashText.indexOf('-')+1);}else{hashCommand=hashText;}}}if(hashCommand){switch(hashCommand){case'replycomment':ChPages.ToggleCommentForm(hashCommandArg);return false;case'arcommvotepos':case'arcommvoteneg':ChPages.ProcessCommentVoteClick(hashCommand,hashCommandArg);return false;case'weather':ChPages.UpdateWeatherForecast(hashCommandArg);break;}}return true;};ChPages.RunDelayedOperations=function(){if(ChPages._delayedArticleStat){ChPages._delayedArticleStat=false;ChPages.SendArticleStat();}else
if(ChPages._delayedLoadVoteForm){ChPages._delayedLoadVoteForm=false;ChPages.LoadSideVoteForm();}};ChPages.InitCommentForm=function(){$("#commentFormSubmit").click(function(event){ChPages.ProcessCommentSubmit(event);return false;});$("#commentFormClose").click(function(event){ChPages.ShowNormalCommentForm();return false;});};ChPages.ToggleCommentForm=function(cmi){if(!ChPages.IsReplyCommentForm()||(ChPages.IsReplyCommentForm()&&ChPages.GetCommentFormReplyI()!=cmi))ChPages.ShowReplyCommentForm(cmi);else
ChPages.ShowNormalCommentForm();};ChPages.ShowReplyCommentForm=function(cmi){$('#comment_cmi').val(cmi);var commentform=$('#commentformcontainer').detach();$('#commentContainer-'+cmi).after(commentform);$('#commentFormClose').css("display","");};ChPages.ShowNormalCommentForm=function(){$('#comment_cmi').val('0');var commentform=$('#commentformcontainer').detach();$('#endcomments').after(commentform);$('#commentFormClose').css("display","none");};ChPages.ResetCommentForm=function(){$('#in_author').val('');$('#in_email').val('');$('#in_comment').val('');$('#comment_cmi').val('0');};ChPages.IsReplyCommentForm=function(){if($('#comment_cmi').val()=='0')return false;else
return true;};ChPages.SetCommentFormReplyI=function(i){$('#comment_cmi').val(i);};ChPages.GetCommentFormReplyI=function(){return $('#comment_cmi').val();};ChPages.ProcessCommentSubmit=function(event){if(ChPages.ValidateCommentFormData()){ChPages.SendWriteCommentRequestToServer();}return false;};ChPages.ValidateCommentFormData=function(){var authorV=$('#in_author').val();var emailV=$('#in_email').val();var commentV=$('#in_comment').val();if(!authorV||authorV==null){alert("Поле 'Аўтар' пустое");$('#in_author').focus();return false;}if(!commentV||commentV==null){alert("Поле 'Камэнтар' пустое");$('#in_comment').focus();return false;}return true;};ChPages.SendWriteCommentRequestToServer=function(){if(ChPages._isCommentFormAjaxRequest)return;ChPages.ShowCommentFormProgressControl();ChPages._isCommentFormAjaxRequest=true;var authorV=$('#in_author').val();var emailV=$('#in_email').val();var commentV=$('#in_comment').val();var arid=$('#comment_ari').val();var cmid=$('#comment_cmi').val();$.ajax({type:'POST',url:'/commentgate.php',success:ChPages.ProcessCommentServerResponse,data:{'c':'arwritecomsend','i':arid,'c2':'arwritecomsend','i2':cmid,'in_author':authorV,'in_email':emailV,'in_comment':commentV},error:ChPages.AjaxErr});};ChPages.ProcessCommentServerResponse=function(responseText,status){ChPages._isCommentFormAjaxRequest=false;ChPages.HideCommentFormProgressControl();if(responseText!='0'){alert('Ошибка добавления комментария');return;}ChPages.ShowFutureCommentPlaceholder();if(ChPages.IsReplyCommentForm()){ChPages.RemoveCommentReplyLink(ChPages.GetCommentFormReplyI());}ChPages.ResetCommentForm();ChPages.ShowNormalCommentForm();ChPages.HideProgressControl();alert('Комментарий добавлен');};ChPages.ShowFutureCommentPlaceholder=function(){if(ChPages.IsReplyCommentForm()){var cmi=ChPages.GetCommentFormReplyI();var placeholder=$('#addedCommentPlaceholder').clone().css("display","");$('#commentContainer-'+cmi).after(placeholder);}else{var placeholder=$('#addedCommentPlaceholder').clone().css("display","");$('#endcomments').before(placeholder);}};ChPages.RemoveCommentReplyLink=function(cmi){$('#commentContainer-'+cmi+' .replyLink').remove();};ChPages.ProcessCommentVoteClick=function(command,commentNum){if(ChPages._isCommentFormAjaxRequest)return;ChPages.ShowCommentFormProgressControl();ChPages._isCommentFormAjaxRequest=true;ChPages._curCommand=command;ChPages._commentNum=commentNum;if(!$.cookie('cli2')){ChPages.MakeClientIRequest();}else{ChPages.MakeCommentVoteRequest(command,commentNum);}return false;};ChPages.MakeCommentVoteRequest=function(command,commentNum){ChPages.ShowCommentFormProgressControl();ChPages._isCommentFormAjaxRequest=true;$.ajax({type:'POST',url:'/commentgate.php',success:ChPages.ProcessCommentVoteServerResponse,data:{'c':command,'i':commentNum,'c2':command},error:ChPages.AjaxErr});return false;};ChPages.ProcessCommentVoteServerResponse=function(responseText,status){ChPages._isCommentFormAjaxRequest=false;ChPages.HideCommentFormProgressControl();var resParts=responseText.split('<|>');if(responseText.charAt(0)=='0'){var commentId=resParts[1];var updatedComment=resParts[2];if(commentId&&updatedComment){$('#commentContainer-'+commentId).find('.commentVoting').replaceWith(updatedComment);}ChPages.ShowCommentVoteSuccessMsg(commentId);}else{ChPages.ShowCommentVoteErrorMsg(ChPages._commentNum,resParts[1]);return;}};ChPages.ShowCommentVoteSuccessMsg=function(commentId){var msgBlock=$('#commentVoteSuccessMsgPlaceholder');ChPages.ShowCommentVoteMsgBlock(msgBlock,commentId);};ChPages.ShowCommentVoteErrorMsg=function(commentId,errorText){var errBlock=$('#commentVoteErrorMsgPlaceholder').text(errorText);ChPages.ShowCommentVoteMsgBlock(errBlock,commentId);};ChPages.ShowCommentVoteMsgBlock=function(msgBlock,commentId){var commentInfo=$('#commentContainer-'+commentId+' .comment__info');var auxWidth=0;msgBlock.clearQueue().stop().css({'opacity':1}).css("display","").css("left",(commentInfo.position().left+commentInfo.outerWidth()-msgBlock.outerWidth())-auxWidth).css("top",commentInfo.position().top+commentInfo.outerHeight()).delay(2000).fadeOut(1000,function(){});};ChPages.LoadSideVoteForm=function(){if($('.votingContainer').size()>0){$("#voteBut").click(function(event){return ChPages.ProcessVoteClick(event);});var vi=$('.votingContainer input[name="vi"]').val();if($.cookie('voted')){var voteInfo=$.cookie('voted').split(':');if(voteInfo[0]==vi){if(voteInfo[1]=="1"){$('.votingContainer').addClass('noneDisplayed');$('.votedContainer').removeClass('noneDisplayed');}return;}}ChPages._curCommand=ChPages.Command_ShowSideVote;ChPages._commentNum=0;ChPages.MakeVoteRequest(ChPages.Command_ShowSideVote,0);}}
ChPages.ProcessVoteClick=function(event){var isAnswerSelected=false;var qId='';var inElements=document.getElementsByTagName("INPUT");if(inElements){for(i=0;i<inElements.length;i++){if(inElements[i].name=='voting'&&inElements[i].checked){qId=inElements[i].value;isAnswerSelected=true;break;}}}if(!isAnswerSelected){ChPages.ShowVoteErrorMsg('Пожалуйста, выберите ответ');return false;}if(ChPages._isCommentFormAjaxRequest)return;ChPages._isCommentFormAjaxRequest=true;ChPages._curCommand=ChPages.Command_ProcessVote;ChPages._commentNum=qId;if(!$.cookie('cli2')){ChPages.MakeClientIRequest();}else{ChPages.MakeVoteRequest(ChPages.Command_ProcessVote,qId);}return false;}
ChPages.MakeVoteRequest=function(command,qId){if(ChPages._curCommand!=ChPages.Command_ShowSideVote)ChPages.ShowCommentFormProgressControl();ChPages._isCommentFormAjaxRequest=true;$.ajax({type:'POST',url:'/commentgate.php',success:ChPages.ProcessVoteServerResponse,data:{'c':command,'i':qId,'c2':command},error:ChPages.AjaxErr});return false;};ChPages.ProcessVoteServerResponse=function(responseText,status){ChPages._isCommentFormAjaxRequest=false;var resParts=responseText.split('<|>');if(ChPages._curCommand==ChPages.Command_ShowSideVote){if(responseText.charAt(0)=='0'){var updatedHtml=resParts[1];if(updatedHtml){$('.votingContainer').replaceWith(updatedHtml);}}$("#voteBut").click(function(event){return ChPages.ProcessVoteClick(event);});}else
if(responseText.charAt(0)=='0'){var updatedHtml=resParts[1];if(updatedHtml){$('.votingContainer').replaceWith(updatedHtml);}ChPages.ShowVoteSuccessMsg();}else{ChPages.ShowVoteErrorMsg(resParts[1]);return;}};ChPages.ShowVoteSuccessMsg=function(){var msgBlock=$('#voteSuccessMsgPlaceholder');ChPages.ShowVoteMsgBlock(msgBlock);};ChPages.ShowVoteErrorMsg=function(errorText){var errBlock=$('#voteErrorMsgPlaceholder').text(errorText);ChPages.ShowVoteMsgBlock(errBlock);};ChPages.ShowVoteMsgBlock=function(msgBlock){var voteInfo=$('.votingContainer');var auxWidth=0;msgBlock.clearQueue().stop().css({'opacity':1}).css("display","").css("left",voteInfo.position().left).css("width",voteInfo.innerWidth()-36).css("top",voteInfo.position().top+voteInfo.outerHeight()-10).delay(2000).fadeOut(1000,function(){});};ChPages.CheckNeedArticleStat=function(){return window.articleStatI||window.articleCommentsStatI;}
ChPages.SendArticleStat=function(){if(window.articleStatI||window.articleCommentsStatI){ChPages._isCommentFormAjaxRequest=true;if(window.articleStatI){ChPages._curCommand=ChPages.Command_ArticleStat;ChPages._commentNum=window.articleStatI;ChPages._curCommandI=window.articleStatI;}if(window.articleCommentsStatI){ChPages._curCommand=ChPages.Command_ArticleCommentsStat;ChPages._commentNum=window.articleCommentsStatI;ChPages._curCommandI=window.articleCommentsStatI;}{ChPages.MakeArticleStatRequest();}}}
ChPages.MakeArticleStatRequest=function(){ChPages._isCommentFormAjaxRequest=true;$.ajax({type:'GET',url:'/stat.php',success:ChPages.ProcessArticleStatServerResponse,data:{'c':ChPages._curCommand,'i':ChPages._curCommandI,'c2':ChPages._curCommand,'i2':ChPages._curCommandI},error:ChPages.SilentAjaxErr});return false;};ChPages.ProcessArticleStatServerResponse=function(responseText,status){ChPages._isCommentFormAjaxRequest=false;ChPages.RunDelayedOperations();};ChPages.MakeClientIRequest=function(){$.ajax({type:'POST',url:'/commentgate.php',success:ChPages.ProcessClientIServerResponse,data:{'c':'ascli','i':0,'c2':'ascli'},error:ChPages.AjaxErr});return false;};ChPages.ProcessClientIServerResponse=function(responseText,status){if(ChPages._curCommand){if(ChPages._curCommand==ChPages.Command_ProcessVote)ChPages.MakeVoteRequest(ChPages._curCommand,ChPages._commentNum);else
if(ChPages._curCommand==ChPages.Command_ArticleStat)ChPages.MakeArticleStatRequest(ChPages._curCommandI);else
ChPages.MakeCommentVoteRequest(ChPages._curCommand,ChPages._commentNum);}};ChPages.AjaxErr=function(){ChPages._isCommentFormAjaxRequest=false;alert('Ошибка связи с сервером');ChPages.HideCommentFormProgressControl();ChPages.RunDelayedOperations();};ChPages.SilentAjaxErr=function(){ChPages._isCommentFormAjaxRequest=false;ChPages.HideCommentFormProgressControl();ChPages.RunDelayedOperations();};ChPages.ShowCommentFormProgressControl=function(){try{var progressPanel=$("#commentFormProgressPanel");var progressimage=$("#progressimage");var commentformCtrl=$("#commentformcontainer");var in_comment=$("#in_comment");var progressimageLeft=in_comment.position().left+(in_comment.outerWidth()/2);var progressimageLeft=in_comment.position().left+(in_comment.outerWidth()/2);progressPanel.css("display","block").css("left",0).css("top",0).css("width",$(document).width()).css("height",$(document).height()).css({'opacity':0.8});progressimage.css("display","block").css("left",progressimageLeft).css("top",commentformCtrl.position().top+commentformCtrl.outerHeight()/2);}catch(ex){}};ChPages.HideCommentFormProgressControl=function(){$("#progressimage").css("display","none");$("#commentFormProgressPanel").css("display","none");};ChPages.ResizeCommentFormProgressControl=function(){if(ChPages._isCommentFormAjaxRequest){ChPages.HideCommentFormProgressControl();ChPages.ShowCommentFormProgressControl();}};ChPages.ShowProgressControl=function(el,correctionX,correctionY){};ChPages.HideProgressControl=function(){};